## 서버 기능 명세 문서
<a href = "https://www.notion.so/285e8386fa6880f486a7e3a9d57e21cf?source=copy_link"><h3>Click Me</h3></a>

<br>

## 자동 빌드
### `./gradlew build --continuous`

## 자동 실행
### `./gradlew bootRun`

<br>

# 6. 데이터 생성 기능 구현 로드맵

`DataGenerationService.java` 클래스에 시뮬레이션 데이터 생성 기능을 구현하기 위한 단계별 로드맵입니다.

## Phase 1: 기반 모델 및 설정 구축

- **1-1. 데이터 구조 정의:**
    - `Building`, `Floor`, `Device` 등 기존 엔티티를 활용하고, 비교군 빌딩 데이터 저장을 위한 새로운 엔티티 또는 DTO를 정의합니다.
    - 에너지 사용량(`ElectricityReading`, `GasReading`, `WaterReading`) 엔티티를 활용합니다.
- **1-2. `DataGenerationService` 클래스 생성:**
    - 데이터 생성 로직을 담당할 `@Service` 클래스를 생성합니다.
- **1-3. 상수 값 설정:**
    - `src/main/java/com/ThreeZem/three_zem_back/data/constant` 패키지 내에 장비별 소비 전력, 1인당 물 사용량 등 시뮬레이션에 필요한 상수 값들을 정의합니다.

## Phase 2: 메인 빌딩("토리 빌딩") 기본 데이터 생성

- **2-1. "토리 빌딩" 모델링:**
    - README에 명시된 층, 용도, 장비(컴퓨터, 조명, 냉난방기) 개수 정보를 바탕으로 빌딩의 구조를 메모리에 생성하는 로직을 구현합니다.
- **2-2. 핵심 사용량 계산 로직 구현:**
    - 시간 및 계절 변화를 제외한 기본 전력, 수도, 가스 사용량 계산 로직을 구현합니다.
    - 전력: `(켜진 장비 수 * 시간당 소비 전력)`
    - 수도/가스: `(상주 인원 * 시간당 평균 사용량)`
- **2-3. 스케줄러 설정:**
    - `@Scheduled` 어노테이션을 사용하여 10초마다 데이터 생성 메서드를 호출하는 스케줄러를 구현합니다.

## Phase 3: 현실성 및 시간적 변화 추가 (토리 빌딩)

- **3-1. 시간 기반 변화 구현:**
    - 운영 시간(08:00-21:00), 피크 시간(09:00-18:00), 주말 및 공휴일을 구분하여 사용량 패턴에 변화를 줍니다.
    - 출근, 점심, 퇴근 시간대의 인원 변동을 반영하여 수도 사용량에 변화를 줍니다.
- **3-2. 계절 기반 변화 구현:**
    - 여름철에는 냉난방기 사용량을 늘리고, 겨울철에는 가스(난방) 사용량을 늘리는 등 계절적 요인을 반영합니다.
- **3-3. 랜덤 변동성 추가:**
    - 계산된 모든 최종 값에 `+-5%` 범위의 랜덤 노이즈를 추가하여 예측 불가능한 실제 사용 패턴을 모방합니다.
- **3-4. 특수 이벤트 시뮬레이션:**
    - README에 명시된 10개 이상의 특수 상황(예: 회의, 야근, 휴강, 방문객 급증 등)을 리스트업하고, 낮은 확률로 랜덤하게 발생시켜 데이터의 현실감을 더하는 로직을 구현합니다.

## Phase 4: 데이터 영속성 및 이력 관리 (토리 빌딩)

- **4-1. 실시간 데이터 저장:**
    - 10초마다 생성된 데이터를 메모리에 보관하고, 5분마다 DB에 일괄 저장(`batch insert`)하는 로직을 구현합니다.
- **4-2. 과거 데이터 생성 (최초 실행):**
    - 애플리케이션이 처음 시작될 때, 지난 3년 치의 과거 사용량 데이터를 생성하여 DB에 저장하는 로직을 구현합니다. 이 작업은 `ApplicationRunner`를 활용하여 구현할 수 있습니다.
- **4-3. 누락 데이터 보완 (재실행 시):**
    - 애플리케이션 재시작 시, 지난 1년간의 데이터 중 누락된 부분이 있는지 확인하고, 규칙에 맞게 데이터를 채워 넣는 로직을 구현합니다.

## Phase 5: 비교군 빌딩 데이터 생성

- **5-1. 비교군 빌딩 생성 및 저장:**
    - IT 직군 비율, 인구수 등을 고려하여 전국 100개 빌딩의 위치를 분포시키고, `+-20%` 규모 편차를 적용하여 빌딩 정보를 생성한 후 DB에 저장합니다.
- **5-2. 비교군 빌딩 과거 데이터 생성:**
    - 생성된 100개 빌딩 각각에 대해, 운영 시간, 피크 시간, 계절적 요인을 고려하여 1시간 단위의 지난 3년 치 사용량(전력, 수도, 가스) 데이터를 생성하고 DB에 저장합니다. 이 로직은 빌딩 전체 사용량만 계산합니다.

## Phase 6: 통합 및 고도화

- **6-1. 서비스 통합:**
    - `DataGenerationService`가 애플리케이션의 생명주기에 맞게 적절히 호출되고 실행되는지 확인합니다.
- **6-2. 로깅 및 모니터링:**
    - 데이터 생성 과정의 주요 단계마다 로그를 추가하여 진행 상황과 발생 가능한 오류를 쉽게 추적할 수 있도록 합니다.
- **6-3. 코드 리팩토링 및 최적화:**
    - 특히 대량의 과거 데이터를 생성하는 로직의 성능을 검토하고 최적화합니다.
- **6-4. 단위 테스트 작성:**
    - 핵심 사용량 계산 로직, 랜덤 변동성 추가 등 주요 기능에 대한 단위 테스트를 작성하여 코드의 신뢰성을 확보합니다.